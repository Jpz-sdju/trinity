`begin_keywords "1800-2023"
`line 1 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 1
 
 
 
     
  
 
import "DPI-C" function int jtag_tick
(
 output bit jtag_TCK,
 output bit jtag_TMS,
 output bit jtag_TDI,
 output bit jtag_TRSTn,

`line 14 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
 input bit  jtag_TDO
);
  

`line 18 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
module SimJTAG #(
                 parameter TICK_DELAY = 50
                 )(

`line 22 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
                   input         clock,
                   input         reset,

`line 25 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
                   input         enable,
                   input         init_done,

`line 28 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
                   output        jtag_TCK,
                   output        jtag_TMS,
                   output        jtag_TDI,
                   output        jtag_TRSTn,

`line 33 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
                   input         jtag_TDO_data,
                   input         jtag_TDO_driven,

`line 36 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
                   output [31:0] exit
                   );

`line 39 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
 
    
    
   
   reg [31:0]                    tickCounterReg;
   wire [31:0]                   tickCounterNxt;

`line 46 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
   assign tickCounterNxt = (tickCounterReg == 0) ? TICK_DELAY :  (tickCounterReg - 1);

`line 48 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
   bit          r_reset;

`line 50 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
   logic [31:0] random_bits = $random;

`line 52 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
   wire         #0.1 __jtag_TDO = jtag_TDO_driven ?
                jtag_TDO_data : random_bits[0];

`line 55 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
   bit          __jtag_TCK;
   bit          __jtag_TMS;
   bit          __jtag_TDI;
   bit          __jtag_TRSTn;
   int          __exit;

`line 61 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
   reg          init_done_sticky;

`line 63 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
   assign #0.1 jtag_TCK   = __jtag_TCK;
   assign #0.1 jtag_TMS   = __jtag_TMS;
   assign #0.1 jtag_TDI   = __jtag_TDI;
   assign #0.1 jtag_TRSTn = __jtag_TRSTn;

`line 68 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
   assign #0.1 exit = __exit;

`line 70 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
   always @(posedge clock) begin
      r_reset <= reset;
      if (reset || r_reset) begin
         __exit = 0;
         tickCounterReg <= TICK_DELAY;
         init_done_sticky <= 1'b0;
         __jtag_TCK = !__jtag_TCK;
      end else begin
         init_done_sticky <= init_done | init_done_sticky;
         if (enable && init_done_sticky) begin
            tickCounterReg <= tickCounterNxt;
            if (tickCounterReg == 0) begin
               __exit = jtag_tick(
                                  __jtag_TCK,
                                  __jtag_TMS,
                                  __jtag_TDI,
                                  __jtag_TRSTn,
                                  __jtag_TDO);
            end
         end  
      end  
   end  

`line 93 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
        
        
        
      
            
  

`line 100 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
endmodule

`line 102 "/nfs/home/jinpeize/trinity/difftest/src/test/vsrc/common/SimJTAG.v" 0
